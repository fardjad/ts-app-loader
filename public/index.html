<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="color-scheme" content="light dark" />
  <title>Loader</title>

  <script type="importmap">
      {
        "imports": {
          "typescript": "https://esm.sh/typescript@5.7.3",
          "@typescript/vfs": "https://esm.sh/@typescript/vfs@1.6.0",
          "mime/": "https://esm.sh/mime@4.0.6/"
        }
      }
    </script>
</head>

<body>
  <div id="app">
    <button id="accessDirButton">Load Directory</button>
  </div>

  <script type="module">
    import { accessDirectory } from './load-dir.js'

    if (!navigator.serviceWorker.controller) {
      const registrations = await navigator.serviceWorker.getRegistrations()
      await Promise.all(registrations.map(r => r.unregister()))
    }

    await navigator.serviceWorker
      .register('./sw.js')
      .then(() => console.log('Service Worker registered!'))
      .catch((error) => console.error('Service Worker registration failed:', error));

    document.querySelector('#accessDirButton').addEventListener('click', async () => {
      await accessDirectory()
      window.location.href = "/index.html"
    })
  </script>
</body>

</html>